<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Galera do Volei - Dashboard CRUD Completo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Estilo Base: Dark Mode, Fonte Monospace */
        body { 
            font-family: 'Consolas', 'Courier New', monospace; 
            background-color: #1c1c1c; 
            color: #d4d4d4; 
            margin: 0; 
            padding: 30px; 
        }
        h1 { color: #4CAF50; font-size: 28px; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 25px; }
        
        /* Layout */
        .grid-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .module-card { background-color: #252526; border: 1px solid #555; padding: 20px; border-radius: 4px; margin-bottom: 20px; }
        .module-card h2 { color: #FFC107; font-size: 18px; border-bottom: 1px solid #333; padding-bottom: 5px; margin-top: 0; }

        /* Formulários e Inputs */
        label { display: block; margin-top: 10px; font-size: 14px; color: #a0a0a0; }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            background-color: #1c1c1c;
            border: 1px solid #555;
            color: #d4d4d4;
            border-radius: 2px;
            font-family: inherit;
        }
        
        /* Botões */
        .btn-group button { margin-right: 10px; }
        .btn-tech { padding: 8px 15px; background-color: #007ACC; color: white; border: none; border-radius: 2px; cursor: pointer; font-family: inherit; font-weight: bold; }
        .btn-action { background-color: #4CAF50; }
        .btn-update { background-color: #FFC107; color: black; }
        .btn-delete { background-color: #F44336; }

        /* Tabela de Dados */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        .data-table th { color: #FFC107; background-color: #2c2c2c; border-bottom: 1px solid #444; padding: 10px; }
        .data-table td { border-bottom: 1px dashed #444; padding: 10px; }

        /* Console de Resposta */
        #response-console { 
            background-color: #111; 
            color: #00FF00; /* Verde Neon */
            padding: 10px; 
            min-height: 200px; 
            max-height: 400px;
            overflow-y: scroll;
            border: 1px solid #4CAF50;
            white-space: pre-wrap; /* Quebra de linha */
        }
    </style>
</head>
<body>
    <h1>&gt; VOLEI_DB_CONSOLE_FULL</h1>

    <div class="grid-layout">
        
        <div class="main-content">
            
            <div class="module-card">
                <h2>1. Consultar & Listar Todos (CRUD: GET)</h2>
                <div class="btn-group">
                    <button class="btn-tech btn-action" onclick="fetchResource('jogadores', 'GET')">GET Jogadores (All)</button>
                    <button class="btn-tech btn-action" onclick="fetchResource('partidas', 'GET')">GET Partidas (All)</button>
                    <button class="btn-tech btn-action" onclick="fetchResource('solicitacoes', 'GET')">GET Solicitações (All)</button>
                </div>
                <hr style="border-color:#333; margin:15px 0;">
                
                <label for="resource-id">Consultar por ID (GET /recurso/:id):</label>
                <input type="number" id="resource-id" placeholder="Ex: 1">
                <div class="btn-group" style="margin-top:10px;">
                    <button class="btn-tech" onclick="fetchResourceById('jogadores', 'GET')">GET Jogador</button>
                    <button class="btn-tech" onclick="fetchResourceById('partidas', 'GET')">GET Partida</button>
                </div>
            </div>

            <div class="module-card">
                <h2>2. Criar Novo Jogador (CRUD: POST)</h2>
                <form id="form-create-jogador" onsubmit="handleFormSubmit(event, 'jogadores', 'POST')">
                    <label>Nome:</label><input type="text" name="nome" value="Amanda Volei">
                    <label>Idade:</label><input type="number" name="idade" value="24">
                    <label>Sexo:</label><input type="text" name="sexo" value="feminino">
                    <label>Categoria:</label><input type="text" name="categoria" value="intermediario">
                    <label>Avaliacao:</label><input type="number" step="0.1" name="avaliacao" value="7.5">
                    <button type="submit" class="btn-tech btn-action" style="margin-top: 15px;">POST /jogadores</button>
                </form>
            </div>
            
            <div class="module-card">
                <h2>3. Transação: Candidatura e Aceite</h2>
                <form id="form-candidatura" onsubmit="handleCandidatura(event)">
                    <label>ID da Partida:</label><input type="number" id="candidatura-partida-id" value="1">
                    <label>ID do Jogador:</label><input type="number" id="candidatura-jogador-id" value="1">
                    <button type="submit" class="btn-tech" style="margin-top: 15px;">POST /candidatura</button>
                </form>
                
                <form id="form-aceite" onsubmit="handleAceite(event)">
                    <hr style="border-color:#333; margin:15px 0;">
                    <label>ID da Solicitação (Ex: 1):</label><input type="number" id="aceite-solicitacao-id" value="1">
                    <label>Token Admin (99):</label><input type="number" id="admin-token" value="99">
                    <div class="btn-group" style="margin-top:10px;">
                        <button type="submit" data-status="aceito" class="btn-tech btn-action">PATCH Aceitar</button>
                        <button type="submit" data-status="recusado" class="btn-tech btn-delete">PATCH Recusar</button>
                    </div>
                </form>
            </div>
            
        </div>
        
        <div class="side-content">
            <div class="module-card">
                <h2>Console de Resposta</h2>
                <div id="response-console">Aguardando requisição...</div>
            </div>
            
            <div class="module-card">
                <h2>DELETE Recurso</h2>
                <form id="form-delete" onsubmit="handleDelete(event)">
                    <label for="delete-id">ID do Recurso a Deletar:</label><input type="number" id="delete-id" value="3">
                    <div class="btn-group" style="margin-top:10px;">
                        <button type="submit" data-resource="jogadores" class="btn-tech btn-delete">DELETE Jogador</button>
                        <button type="submit" data-resource="partidas" class="btn-tech btn-delete">DELETE Partida</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:3000/api';
        const consoleElement = document.getElementById('response-console');

        function logToConsole(title, data, status) {
            const statusColor = status >= 200 && status < 300 ? '#4CAF50' : (status >= 400 ? '#F44336' : '#FFC107');
            const dataString = JSON.stringify(data, null, 2);
            
            consoleElement.innerHTML = `<span style="color:${statusColor};">STATUS: ${status}</span> - ${title}\n` + dataString + '\n\n' + consoleElement.innerHTML;
        }

        function getFormData(form) {
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                // Tenta converter para número/float se for um campo numérico
                data[key] = isNaN(parseFloat(value)) || isNaN(parseInt(value)) ? value : (value.includes('.') ? parseFloat(value) : parseInt(value));
            }
            return data;
        }

        // --- FETCH GENÉRICO (Lê todos e por ID) ---
        async function fetchResource(resource, method) {
            try {
                const response = await fetch(`${BASE_URL}/${resource}`);
                const data = await response.json();
                logToConsole(`${method} /${resource}`, data, response.status);
            } catch (error) {
                logToConsole(`Erro no ${method} /${resource}`, { message: 'Falha na rede ou servidor offline.' }, 500);
            }
        }
        
        async function fetchResourceById(resource, method) {
            const id = document.getElementById('resource-id').value;
            if (!id) return;
            try {
                const response = await fetch(`${BASE_URL}/${resource}/${id}`);
                const data = await response.json();
                logToConsole(`${method} /${resource}/${id}`, data, response.status);
            } catch (error) {
                logToConsole(`Erro no ${method} /${resource}/${id}`, { message: 'Falha na rede ou servidor offline.' }, 500);
            }
        }

        // --- HANDLERS DE FORMULÁRIO (POST, PUT) ---
        async function handleFormSubmit(event, resource, method) {
            event.preventDefault();
            const form = event.target;
            const data = getFormData(form);

            try {
                const response = await fetch(`${BASE_URL}/${resource}`, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const responseData = await response.json();
                logToConsole(`${method} /${resource}`, responseData, response.status);
            } catch (error) {
                logToConsole(`Erro no ${method} /${resource}`, { message: 'Falha na rede ou servidor offline.' }, 500);
            }
        }

        // --- HANDLER DELETE ---
        async function handleDelete(event) {
            event.preventDefault();
            const resource = event.submitter.getAttribute('data-resource');
            const id = document.getElementById('delete-id').value;
            if (!id) return;

            try {
                const response = await fetch(`${BASE_URL}/${resource}/${id}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                logToConsole(`DELETE /${resource}/${id}`, data, response.status);
            } catch (error) {
                logToConsole(`Erro no DELETE /${resource}/${id}`, { message: 'Falha na rede ou servidor offline.' }, 500);
            }
        }

        // --- HANDLER TRANSAÇÃO: CANDIDATURA (POST) ---
        async function handleCandidatura(event) {
            event.preventDefault();
            const partidaId = document.getElementById('candidatura-partida-id').value;
            const jogadorId = document.getElementById('candidatura-jogador-id').value;

            try {
                const response = await fetch(`${BASE_URL}/partidas/${partidaId}/candidatura`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idJogador: parseInt(jogadorId) })
                });
                const data = await response.json();
                logToConsole(`POST /partidas/${partidaId}/candidatura`, data, response.status);
            } catch (error) {
                logToConsole(`Erro no POST /candidatura`, { message: 'Falha na rede ou servidor offline.' }, 500);
            }
        }

        // --- HANDLER TRANSAÇÃO: ACEITE (PATCH) ---
        async function handleAceite(event) {
            event.preventDefault();
            const solicitacaoId = document.getElementById('aceite-solicitacao-id').value;
            const adminToken = document.getElementById('admin-token').value;
            const status = event.submitter.getAttribute('data-status');
            
            try {
                const response = await fetch(`${BASE_URL}/solicitacoes/${solicitacaoId}`, {
                    method: 'PATCH',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}` // Adiciona o token para o Middleware
                    },
                    body: JSON.stringify({ status })
                });
                const data = await response.json();
                logToConsole(`PATCH /solicitacoes/${solicitacaoId} (Status: ${status})`, data, response.status);
            } catch (error) {
                logToConsole(`Erro no PATCH /solicitacoes`, { message: 'Falha na rede ou servidor offline.' }, 500);
            }
        }
        
    </script>
</body>
</html>